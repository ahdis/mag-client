<mat-card class="display">
  <mat-card-content>
    <mat-card-header>
      <mat-card-title
        >Mobile Access Gateway - Patient Identifiers</mat-card-title
      >
    </mat-card-header>

    <div>
      <mat-form-field>
        <mat-label>sourceIdentifier system</mat-label>
        <input matInput [formControl]="sourceIdentifierSystem" />
      </mat-form-field>
      &nbsp;
      <mat-form-field>
        <mat-label>sourceIdentifier value</mat-label>
        <input matInput [formControl]="sourceIdentifierValue" />
      </mat-form-field>
    </div>
    <div>
      <mat-form-field>
        <mat-label>targetIdentifier system (MPI-ID)</mat-label>
        <input matInput [formControl]="targetIdentifierSystem" />
      </mat-form-field>
      &nbsp;
      {{ targetIdentifierValue }}
    </div>
    <div>
      <mat-form-field>
        <mat-label>targetIdentifier system (EPR-SPID)</mat-label>
        <input matInput [formControl]="targetIdentifier2System" />
      </mat-form-field>
      &nbsp;
      {{ targetIdentifier2Value }}
    </div>

    <div>
      <div>targetId: {{ targetId }}</div>
    </div>

    <ng-container *ngIf="inPixmProgress">
      <mat-progress-spinner mode="indeterminate"> </mat-progress-spinner>
    </ng-container>

    <mat-card-actions>
      <button
        mat-raised-button
        color="primary"
        type="submit"
        (click)="onPIXmQuery()"
      >
        PIXm Query
      </button>
    </mat-card-actions>
  </mat-card-content>
</mat-card>

<mat-card class="display">
  <mat-card-content>
    <mat-card-header>
      <mat-card-title>Mobile Access Gateway - Authenticate</mat-card-title>
    </mat-card-header>

    <div>
      <mat-form-field>
        <mat-label>Authenticate/Authorize</mat-label>
        <select matNativeControl required [formControl]="authenticate">
          <option value="Patient">Patient</option>
          <option value="HCP">HCP</option>
        </select>
      </mat-form-field>
    </div>

    <div>
      <pre><code [highlight]="getScopes()"></code></pre>
    </div>

    <mat-card-actions>
      <button
        mat-raised-button
        color="primary"
        type="submit"
        (click)="onAuthenticate()"
      >
        Authenticate
      </button>
    </mat-card-actions>
  </mat-card-content>
</mat-card>

<mat-card class="display">
  <mat-card-content>
    <mat-card-header>
      <mat-card-title>Mobile Access Gateway - Query</mat-card-title>
    </mat-card-header>

    <mat-table #table [dataSource]="dataSource">
      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef class="name"
          >Description</mat-header-cell
        >
        <mat-cell *matCellDef="let entry" class="name">
          {{ entry.description }}
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="title">
        <mat-header-cell *matHeaderCellDef class="title">Title</mat-header-cell>
        <mat-cell *matCellDef="let entry" class="title">
          <div>
            {{ entry.content[0].attachment.title }}
          </div>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="contentType">
        <mat-header-cell *matHeaderCellDef class="contentType"
          >Title</mat-header-cell
        >
        <mat-cell *matCellDef="let entry" class="contentType">
          <div>
            {{ entry.content[0].attachment.contentType }}
          </div>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="formatCode">
        <mat-header-cell *matHeaderCellDef class="formatCode"
          >formatCode</mat-header-cell
        >
        <mat-cell *matCellDef="let entry" class="formatCode">
          <div>
            {{ entry.content[0].format.code }}
          </div>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="action">
        <mat-header-cell *matHeaderCellDef class="res">Actions</mat-header-cell>
        <mat-cell *matCellDef="let entry" class="res">
          <button
            mat-icon-button
            aria-label="Remove"
            (click)="remove(entry)"
            type="button"
          >
            <mat-icon>remove</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <mat-header-row
        *matHeaderRowDef="['name', 'title', 'contentType', 'formatCode']"
      ></mat-header-row>
      <mat-row
        *matRowDef="
          let row;
          columns: ['name', 'title', 'contentType', 'formatCode']
        "
        (click)="onDownloadDocumentReferenceAttachment(row)"
      >
      </mat-row>
    </mat-table>

    <ng-container *ngIf="inMhdProgress">
      <mat-progress-spinner mode="indeterminate"> </mat-progress-spinner>
    </ng-container>

    <mat-card-actions>
      <button
        mat-raised-button
        type="submit"
        (click)="onFindDocumentReferences()"
      >
        Document References
      </button>
      <button mat-raised-button type="submit" (click)="onFindMedicationList()">
        Medication List
      </button>
      <button mat-raised-button type="submit" (click)="onFindMedicationCard()">
        Medication Card
      </button>
    </mat-card-actions>

    <ng-container *ngIf="canTransform()">
      <mat-card-actions>
        <button mat-raised-button type="submit" (click)="onTransform()">
          Transform
        </button>
        <button mat-raised-button type="submit" (click)="onPdf()">Pdf</button>
      </mat-card-actions>
    </ng-container>
  </mat-card-content>
</mat-card>

<mat-card class="display">
  <mat-card-content>
    <mat-card-header>
      <mat-card-title>Mobile Access Gateway - Upload</mat-card-title>
    </mat-card-header>

    <app-upload (addFiles)="addFile($event)"> </app-upload>

    <div>
      <mat-form-field>
        <mat-label>Description</mat-label>
        <input matInput [formControl]="documentDescription" />
      </mat-form-field>
    </div>
    <div>
      <mat-form-field>
        <mat-label>Document Type</mat-label>
        <select matNativeControl required [formControl]="documentType">
          <option value="APPC">APPC Document</option>
          <option value="MTP">Medication Treatment Plan</option>
          <option value="PDF">PDF</option>
        </select>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field>
        <mat-label>DocumentEntry.masterIdentifier (uuid)</mat-label>
        <input matInput [formControl]="masterIdentifier" />
      </mat-form-field>
    </div>
    <div>
      <mat-form-field>
        <mat-label>DocumentEntry.creationTime</mat-label>
        <input matInput [formControl]="creationTime" />
      </mat-form-field>
    </div>
    <div>
      <div>
        <mat-form-field>
          <mat-label>ihe-sourceId</mat-label>
          <input matInput [formControl]="iheSourceId" /> </mat-form-field
        >&nbsp;
        <a
          href="https://profiles.ihe.net/ITI/MHD/4.0.2/StructureDefinition-ihe-sourceId.html"
          >ig</a
        >
      </div>
      <div>
        <button
          mat-raised-button
          type="submit"
          (click)="createMhdTransaction()"
        >
          Test MHD
        </button>
      </div>
    </div>
  </mat-card-content>
</mat-card>

<mat-card class="display">
  <mat-card-content>
    <mat-card-header>
      <mat-card-title>Response</mat-card-title>
    </mat-card-header>
    <div *ngIf="errMsg">{{ errMsg }}</div>

    <pre><code [highlight]="getJson()" [lineNumbers]="true"></code></pre>
  </mat-card-content>
</mat-card>
